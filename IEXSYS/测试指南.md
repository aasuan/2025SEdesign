# 登录注册功能测试指南

本指南将帮助您使用 IDEA 和 Apifox 测试 IEXSYS 项目的登录注册功能。

## 一、环境准备

### 1. 前置条件
- ✅ MySQL 数据库已安装并运行（默认端口 3306）
- ⚠️ Redis（可选）：如果未安装 Redis，项目已配置为使用内存 Session，可以直接运行
  - 如需使用 Redis，请参考 `Redis安装和使用指南.md`
  - 当前配置已注释 Redis，使用内存 Session（适合快速测试）
- ✅ JDK 17 已安装
- ✅ IDEA 已安装
- ✅ Apifox 已安装

> **提示**：如果您没有安装 Redis，当前配置已经设置为使用内存 Session，可以直接启动项目进行测试。应用重启后 Session 会丢失，但完全不影响功能测试。

### 2. 数据库配置
根据 `application.properties` 配置，确保：
- 数据库名：`online_exam_system`
- 用户名：`root`
- 密码：`123456`
- 如果您的数据库配置不同，请修改 `src/main/resources/application.properties` 文件

### 3. 创建数据库
在 MySQL 中执行以下命令创建数据库：
```sql
CREATE DATABASE IF NOT EXISTS online_exam_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

## 二、在 IDEA 中启动项目

### 步骤 1：导入项目
1. 打开 IDEA
2. 选择 `File` → `Open`
3. 选择 `IEXSYS` 文件夹
4. 等待 Maven 依赖下载完成

### 步骤 2：配置运行环境
1. 确保 MySQL 服务已启动
2. Redis（可选）：如果使用 Redis，确保 Redis 服务已启动；如果使用内存 Session（当前配置），无需 Redis
3. 检查 `application.properties` 中的数据库配置是否正确

### 步骤 3：启动应用
**方法一：使用 IDEA 运行**
1. 找到主类：`org.exp.iexsys.IexsysApplication`
2. 右键点击 → `Run 'IexsysApplication'`
3. 或者点击类旁边的绿色运行按钮

**方法二：使用 Maven 命令**
1. 打开 IDEA 的 Terminal（底部工具栏）
2. 执行命令：
```bash
./mvnw spring-boot:run
```
（Windows 用户使用 `mvnw.cmd spring-boot:run`）

### 步骤 4：验证启动成功
看到以下日志表示启动成功：
```
Started IexsysApplication in X.XXX seconds
```
应用默认运行在：`http://localhost:8080`

## 三、在 Apifox 中测试接口

### 1. 创建项目和环境

#### 创建项目
1. 打开 Apifox
2. 点击 `新建项目`
3. 项目名称：`IEXSYS 测试`
4. 点击 `确定`

#### 配置环境变量
1. 点击左侧 `环境管理`
2. 创建新环境：`本地开发`
3. 添加变量：
   - 变量名：`baseUrl`
   - 变量值：`http://localhost:8080`
4. 保存并设置为当前环境

### 2. 测试注册接口

#### 创建注册请求
1. 在项目中创建文件夹：`认证相关`
2. 在文件夹下创建接口：`用户注册`
3. 配置接口信息：
   - **请求方法**：`POST`
   - **请求 URL**：`{{baseUrl}}/api/auth/register`
   - **请求头**：
     ```
     Content-Type: application/json
     ```
   - **请求体**（Body → raw → JSON）：
     ```json
     {
       "username": "testuser",
       "password": "123456",
       "realName": "测试用户",
       "email": "test@example.com",
       "phone": "13800138000",
       "role": 0
     }
     ```

#### 参数说明
- `username`：用户名（必填，3-16 字符）
- `password`：密码（必填，6-24 字符）
- `realName`：真实姓名（可选）
- `email`：邮箱（可选，需符合邮箱格式）
- `phone`：手机号（可选）
- `role`：角色（可选，0-学生，1-老师，2-管理员，默认为 0）

#### 发送请求
1. 点击 `发送` 按钮
2. 查看响应结果

#### 成功响应示例
```json
{
  "code": 0,
  "message": "注册成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "realName": "测试用户",
    "email": "test@example.com",
    "phone": "13800138000",
    "role": 0
  }
}
```

### 3. 测试登录接口

#### 创建登录请求
1. 在 `认证相关` 文件夹下创建接口：`用户登录`
2. 配置接口信息：
   - **请求方法**：`POST`
   - **请求 URL**：`{{baseUrl}}/api/auth/login`
   - **请求头**：
     ```
     Content-Type: application/json
     ```
   - **请求体**（Body → raw → JSON）：
     ```json
     {
       "username": "testuser",
       "password": "123456"
     }
     ```

#### 发送请求
1. 点击 `发送` 按钮
2. 查看响应结果

#### 成功响应示例
```json
{
  "code": 0,
  "message": "登录成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "realName": "测试用户",
    "email": "test@example.com",
    "phone": "13800138000",
    "role": 0
  }
}
```

**重要提示**：登录成功后，Apifox 会自动保存 Cookie（Session），后续需要登录状态的接口会自动携带。

### 4. 测试获取当前用户接口

#### 创建获取用户信息请求
1. 在 `认证相关` 文件夹下创建接口：`获取当前用户信息`
2. 配置接口信息：
   - **请求方法**：`GET`
   - **请求 URL**：`{{baseUrl}}/api/auth/me`
   - **请求头**：无需额外配置（会自动携带 Cookie）

#### 发送请求
1. **先执行登录接口**，确保有有效的 Session
2. 然后执行 `获取当前用户信息` 接口
3. 查看响应结果

#### 成功响应示例
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "id": 1,
    "username": "testuser",
    "realName": "测试用户",
    "email": "test@example.com",
    "phone": "13800138000",
    "role": 0
  }
}
```

### 5. 测试退出登录接口

#### 创建退出登录请求
1. 在 `认证相关` 文件夹下创建接口：`用户退出`
2. 配置接口信息：
   - **请求方法**：`POST`
   - **请求 URL**：`{{baseUrl}}/api/auth/logout`
   - **请求头**：无需额外配置

#### 发送请求
1. 点击 `发送` 按钮
2. 查看响应结果

#### 成功响应示例
```json
{
  "code": 0,
  "message": "已退出",
  "data": null
}
```

## 四、测试场景示例

### 场景 1：完整注册登录流程
1. **注册新用户**
   - 使用注册接口创建新用户
   - 验证返回的用户信息
   
2. **登录**
   - 使用刚注册的用户名和密码登录
   - 验证登录成功
   
3. **获取用户信息**
   - 调用 `/api/auth/me` 接口
   - 验证返回的用户信息与注册时一致
   
4. **退出登录**
   - 调用退出接口
   - 再次调用 `/api/auth/me`，应该返回 401 未登录

### 场景 2：错误情况测试

#### 测试注册接口错误情况
1. **用户名过短**（少于 3 个字符）
   ```json
   {
     "username": "ab",
     "password": "123456"
   }
   ```
   预期：返回验证错误

2. **密码过短**（少于 6 个字符）
   ```json
   {
     "username": "testuser",
     "password": "12345"
   }
   ```
   预期：返回验证错误

3. **邮箱格式错误**
   ```json
   {
     "username": "testuser",
     "password": "123456",
     "email": "invalid-email"
   }
   ```
   预期：返回验证错误

4. **用户名已存在**
   - 使用已注册的用户名再次注册
   - 预期：返回用户名已存在错误

#### 测试登录接口错误情况
1. **用户名不存在**
   ```json
   {
     "username": "nonexistent",
     "password": "123456"
   }
   ```
   预期：返回用户名或密码错误

2. **密码错误**
   ```json
   {
     "username": "testuser",
     "password": "wrongpassword"
   }
   ```
   预期：返回用户名或密码错误

3. **未登录时访问 /api/auth/me**
   - 不执行登录，直接调用 `/api/auth/me`
   - 预期：返回 401 未登录

## 五、Apifox 高级功能

### 1. 使用前置脚本自动登录
在需要登录的接口中，可以添加前置脚本自动登录：

1. 进入接口的 `前置操作` → `前置脚本`
2. 添加脚本（需要先创建登录接口）：
```javascript
// 自动登录脚本示例
// 注意：这需要根据实际情况调整
```

### 2. 使用环境变量管理测试数据
1. 在环境变量中添加：
   - `testUsername`：测试用户名
   - `testPassword`：测试密码
2. 在请求中使用：`{{testUsername}}` 和 `{{testPassword}}`

### 3. 批量测试
1. 创建测试用例集合
2. 按顺序执行：注册 → 登录 → 获取信息 → 退出
3. 使用 Apifox 的自动化测试功能

## 六、常见问题排查

### 问题 1：连接数据库失败
**症状**：启动时提示无法连接数据库
**解决方案**：
- 检查 MySQL 是否启动
- 检查 `application.properties` 中的数据库配置
- 检查数据库 `online_exam_system` 是否已创建

### 问题 2：连接 Redis 失败
**症状**：启动时提示无法连接 Redis
**解决方案**：
- **推荐**：如果只是测试，可以注释掉 `application.properties` 中的 Redis 配置，使用内存 Session（当前配置已如此设置）
- 如需使用 Redis，请参考 `Redis安装和使用指南.md` 安装 Redis
- 检查 Redis 是否启动
- 检查 `application.properties` 中的 Redis 配置

### 问题 3：接口返回 404
**症状**：Apifox 请求返回 404 Not Found
**解决方案**：
- 检查应用是否成功启动
- 检查请求 URL 是否正确（注意 `/api/auth` 前缀）
- 检查请求方法是否正确（POST/GET）

### 问题 4：Session 不生效
**症状**：登录后调用 `/api/auth/me` 仍然返回未登录
**解决方案**：
- 确保 Apifox 开启了 Cookie 自动管理
- 如果使用 Redis，检查 Redis 是否正常运行
- 如果使用内存 Session，注意应用重启后 Session 会丢失
- 在 Apifox 中查看是否保存了 Cookie
- 确保登录和获取用户信息使用的是同一个 Apifox 环境

### 问题 5：端口被占用
**症状**：启动时提示端口 8080 被占用
**解决方案**：
- 修改 `application.properties` 中的 `server.port` 为其他端口
- 或在 IDEA 的运行配置中修改端口
- 记得同步更新 Apifox 中的 `baseUrl`

## 七、接口清单

| 接口路径 | 方法 | 说明 | 是否需要登录 |
|---------|------|------|-------------|
| `/api/auth/register` | POST | 用户注册 | 否 |
| `/api/auth/login` | POST | 用户登录 | 否 |
| `/api/auth/logout` | POST | 用户退出 | 是 |
| `/api/auth/me` | GET | 获取当前用户信息 | 是 |

## 八、快速开始检查清单

- [ ] MySQL 已启动，数据库 `online_exam_system` 已创建
- [ ] Redis 已启动（如果使用 Redis，否则使用内存 Session 无需 Redis）
- [ ] 在 IDEA 中成功启动应用（端口 8080）
- [ ] 在 Apifox 中创建项目并配置环境变量
- [ ] 测试注册接口成功
- [ ] 测试登录接口成功
- [ ] 测试获取用户信息接口成功
- [ ] 测试退出登录接口成功

---

**祝测试顺利！如有问题，请检查日志输出或联系开发团队。**

