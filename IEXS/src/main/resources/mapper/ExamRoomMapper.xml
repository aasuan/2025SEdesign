<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.mapper.ExamRoomMapper">

    <resultMap id="BaseResultMap" type="ExamRoom">
        <id property="id" column="id"/>
        <result property="examId" column="exam_id"/>
        <result property="studentId" column="student_id"/>
        <result property="status" column="status"/>
        <result property="startTime" column="start_time"/>
        <result property="submitTime" column="submit_time"/>
        <result property="score" column="score"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <select id="selectById" parameterType="Integer" resultMap="BaseResultMap">
        SELECT * FROM exam_room WHERE id = #{id}
    </select>

    <select id="selectByExamAndStudent" resultMap="BaseResultMap">
        SELECT * FROM exam_room 
        WHERE exam_id = #{examId} AND student_id = #{studentId}
    </select>

    <select id="selectByExamId" parameterType="Integer" resultMap="BaseResultMap">
        SELECT * FROM exam_room WHERE exam_id = #{examId}
    </select>

    <select id="selectByStudentId" parameterType="Integer" resultMap="BaseResultMap">
        SELECT * FROM exam_room WHERE student_id = #{studentId} ORDER BY create_time DESC
    </select>

    <insert id="insert" parameterType="ExamRoom" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO exam_room (exam_id, student_id, status)
        VALUES (#{examId}, #{studentId}, #{status})
    </insert>

    <update id="update" parameterType="ExamRoom">
        UPDATE exam_room
        <set>
            <if test="status != null">status = #{status},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="submitTime != null">submit_time = #{submitTime},</if>
            <if test="score != null">score = #{score},</if>
        </set>
        WHERE id = #{id}
    </update>

</mapper>

