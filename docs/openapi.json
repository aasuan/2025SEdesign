{
  "openapi": "3.0.1",
  "info": {
    "title": "Online Exam System API",
    "version": "1.0.0",
    "description": "基于 online_exam_system.sql 数据模型和现有 auth 实现的 REST API 草案。认证采用会话 Cookie（JSESSIONID），响应使用统一结构 ApiResponse<T>{code,message,data}。"
  },
  "servers": [
    { "url": "/api" }
  ],
  "tags": [
    { "name": "Auth", "description": "用户注册、登录、绑定等" },
    { "name": "User", "description": "用户与角色管理" },
    { "name": "Tag", "description": "标签管理" },
    { "name": "Question", "description": "题库管理、导入导出" },
    { "name": "Paper", "description": "试卷管理、组卷" },
    { "name": "Exam", "description": "考试创建、发布、名单" },
    { "name": "Portal", "description": "学生考试门户、作答、监考事件" },
    { "name": "Grading", "description": "自动评分、教师批阅" },
    { "name": "Score", "description": "成绩查询、错题、报告" },
    { "name": "Dashboard", "description": "数据看板、报表" },
    { "name": "Recommendation", "description": "个性化学习计划与练习" }
  ],
  "components": {
    "securitySchemes": {
      "cookieAuth": { "type": "apiKey", "in": "cookie", "name": "JSESSIONID" }
    },
    "schemas": {
      "ApiResponse": {
        "type": "object",
        "properties": {
          "code": { "type": "integer" },
          "message": { "type": "string" },
          "data": {}
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": ["username", "password"],
        "properties": {
          "username": { "type": "string" },
          "password": { "type": "string" }
        }
      },
      "RegisterRequest": {
        "type": "object",
        "required": ["username", "password"],
        "properties": {
          "username": { "type": "string" },
          "password": { "type": "string" },
          "realName": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "phone": { "type": "string" }
        }
      },
      "UserProfile": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "username": { "type": "string" },
          "realName": { "type": "string" },
          "email": { "type": "string" },
          "phone": { "type": "string" },
          "userRole": { "type": "string" },
          "status": { "type": "string", "enum": ["Active", "Inactive", "Locked"] }
        }
      },
      "Role": {
        "type": "object",
        "properties": {
          "roleId": { "type": "integer" },
          "roleName": { "type": "string", "enum": ["Admin", "Teacher", "Student"] },
          "description": { "type": "string" }
        }
      },
      "Tag": {
        "type": "object",
        "properties": {
          "tagId": { "type": "integer" },
          "tagName": { "type": "string" },
          "tagType": { "type": "string", "enum": ["KnowledgePoint", "Difficulty", "Chapter"] },
          "extraInfo": { "type": "object" }
        }
      },
      "Question": {
        "type": "object",
        "properties": {
          "questionId": { "type": "integer" },
          "creatorId": { "type": "integer" },
          "questionType": { "type": "string", "enum": ["SingleChoice", "MultiChoice", "TrueFalse", "FillBlank", "ShortAnswer", "Programming"] },
          "difficulty": { "type": "string", "enum": ["简单", "中等", "困难"] },
          "content": { "type": "string" },
          "options": { "type": "object" },
          "answer": { "type": "string" },
          "defaultScore": { "type": "number", "format": "float" },
          "tags": { "type": "array", "items": { "type": "integer" } },
          "extraInfo": { "type": "object" }
        }
      },
      "PaperQuestionItem": {
        "type": "object",
        "properties": {
          "questionId": { "type": "integer" },
          "questionScore": { "type": "number" },
          "sequenceNum": { "type": "integer" }
        }
      },
      "Paper": {
        "type": "object",
        "properties": {
          "paperId": { "type": "integer" },
          "paperName": { "type": "string" },
          "creatorId": { "type": "integer" },
          "totalScore": { "type": "number" },
          "isDraft": { "type": "boolean" },
          "questions": { "type": "array", "items": { "$ref": "#/components/schemas/PaperQuestionItem" } },
          "extraInfo": { "type": "object" }
        }
      },
      "Exam": {
        "type": "object",
        "properties": {
          "examId": { "type": "integer" },
          "paperId": { "type": "integer" },
          "examName": { "type": "string" },
          "startTime": { "type": "string", "format": "date-time" },
          "endTime": { "type": "string", "format": "date-time" },
          "durationMinutes": { "type": "integer" },
          "proctorId": { "type": "integer" },
          "status": { "type": "string", "enum": ["Pending", "Active", "Finished", "Canceled"] },
          "antiCheatSettings": { "type": "object" }
        }
      },
      "ExamParticipant": {
        "type": "object",
        "properties": {
          "epId": { "type": "integer" },
          "examId": { "type": "integer" },
          "studentId": { "type": "integer" },
          "joinStatus": { "type": "string", "enum": ["Invited", "Joined", "Submitted", "Absent"] },
          "joinTime": { "type": "string", "format": "date-time" },
          "submitTime": { "type": "string", "format": "date-time" }
        }
      },
      "StudentAnswer": {
        "type": "object",
        "properties": {
          "answerId": { "type": "integer" },
          "examId": { "type": "integer" },
          "studentId": { "type": "integer" },
          "questionId": { "type": "integer" },
          "studentResponse": { "type": "string" },
          "isGraded": { "type": "boolean" },
          "obtainedScore": { "type": "number" },
          "graderId": { "type": "integer" },
          "gradeTime": { "type": "string", "format": "date-time" },
          "saveTime": { "type": "string", "format": "date-time" },
          "extraInfo": { "type": "object" }
        }
      },
      "ScoreRecord": {
        "type": "object",
        "properties": {
          "recordId": { "type": "integer" },
          "examId": { "type": "integer" },
          "studentId": { "type": "integer" },
          "paperId": { "type": "integer" },
          "totalScore": { "type": "number" },
          "isFinal": { "type": "boolean" },
          "ranking": { "type": "integer" },
          "extraInfo": { "type": "object" }
        }
      }
    }
  },
  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "用户注册（已实现）",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/RegisterRequest" } }
          }
        },
        "responses": { "200": { "description": "ok", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ApiResponse" } } } } }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "用户名密码登录（已实现）",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/LoginRequest" } }
          }
        },
        "responses": { "200": { "description": "ok", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ApiResponse" } } } } }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "退出登录（已实现）",
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/auth/me": {
      "get": {
        "tags": ["Auth"],
        "summary": "获取当前登录人（已实现）",
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/auth/bind-phone": {
      "post": {
        "tags": ["Auth"],
        "summary": "绑定手机号/第三方",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["phone", "code"],
                "properties": {
                  "phone": { "type": "string" },
                  "code": { "type": "string" },
                  "wxOpenId": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/users": {
      "get": {
        "tags": ["User"],
        "summary": "用户列表（分页/搜索 realName/role/status）",
        "responses": { "200": { "description": "ok" } }
      },
      "post": {
        "tags": ["User"],
        "summary": "创建用户（管理员/教务）",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RegisterRequest" } } }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/users/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["User"], "summary": "查询单个用户", "responses": { "200": { "description": "ok" } } },
      "put": {
        "tags": ["User"],
        "summary": "更新用户基本信息/状态",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": { "realName": { "type": "string" }, "email": { "type": "string" }, "phone": { "type": "string" }, "status": { "type": "string" } }
              }
            }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/users/{id}/roles": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["User"],
        "summary": "分配角色",
        "requestBody": { "content": { "application/json": { "schema": { "type": "object", "properties": { "roleIds": { "type": "array", "items": { "type": "integer" } } } } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/devices/check": {
      "post": {
        "tags": ["Proctor"],
        "summary": "考前设备检查",
        "requestBody": { "content": { "application/json": { "schema": { "type": "object", "properties": { "camera": { "type": "boolean" }, "microphone": { "type": "boolean" }, "os": { "type": "string" }, "browser": { "type": "string" } } } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/identity/verify": {
      "post": {
        "tags": ["Proctor"],
        "summary": "身份核验（人脸/证件）",
        "requestBody": {
          "content": { "application/json": { "schema": { "type": "object", "properties": { "examId": { "type": "integer" }, "studentId": { "type": "integer" }, "faceToken": { "type": "string" }, "idNumber": { "type": "string" } } } } }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/tags": {
      "get": { "tags": ["Tag"], "summary": "标签列表（可按 tagType 过滤）", "responses": { "200": { "description": "ok" } } },
      "post": {
        "tags": ["Tag"],
        "summary": "新增标签",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Tag" } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/tags/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "put": {
        "tags": ["Tag"],
        "summary": "更新标签",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Tag" } } } },
        "responses": { "200": { "description": "ok" } }
      },
      "delete": { "tags": ["Tag"], "summary": "删除标签", "responses": { "200": { "description": "ok" } } }
    },
    "/questions": {
      "get": { "tags": ["Question"], "summary": "题目列表（按类型/难度/标签筛选）", "responses": { "200": { "description": "ok" } } },
      "post": {
        "tags": ["Question"],
        "summary": "新增题目",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Question" } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/questions/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Question"], "summary": "查看题目详情", "responses": { "200": { "description": "ok" } } },
      "put": {
        "tags": ["Question"],
        "summary": "更新题目与标签",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Question" } } } },
        "responses": { "200": { "description": "ok" } }
      },
      "delete": { "tags": ["Question"], "summary": "删除/禁用题目", "responses": { "200": { "description": "ok" } } }
    },
    "/questions/import": {
      "post": {
        "tags": ["Question"],
        "summary": "批量导入，自动识别题型",
        "requestBody": { "content": { "multipart/form-data": { "schema": { "type": "object", "properties": { "file": { "type": "string", "format": "binary" } } } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/questions/export": {
      "get": { "tags": ["Question"], "summary": "按筛选条件导出题库", "responses": { "200": { "description": "ok" } } }
    },
    "/papers": {
      "get": { "tags": ["Paper"], "summary": "试卷列表（草稿/已发布）", "responses": { "200": { "description": "ok" } } },
      "post": {
        "tags": ["Paper"],
        "summary": "创建/保存草稿",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Paper" } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/papers/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Paper"], "summary": "查看/预览试卷", "responses": { "200": { "description": "ok" } } },
      "put": {
        "tags": ["Paper"],
        "summary": "更新试卷（名称/题目顺序/分值）",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Paper" } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/papers/{id}/questions": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Paper"],
        "summary": "批量配置题目",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "type": "object", "properties": { "items": { "type": "array", "items": { "$ref": "#/components/schemas/PaperQuestionItem" } } } }
            }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/papers/{id}/auto-assemble": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Paper"],
        "summary": "智能组卷（难度/知识点/数量策略）",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "type": "object", "properties": { "rules": { "type": "object" }, "totalScore": { "type": "number" } } }
            }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/exams": {
      "get": { "tags": ["Exam"], "summary": "考试列表（按状态/时间筛选）", "responses": { "200": { "description": "ok" } } },
      "post": {
        "tags": ["Exam"],
        "summary": "创建考试（绑定试卷、时间、防作弊规则）",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Exam" } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/exams/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Exam"], "summary": "查询考试详情", "responses": { "200": { "description": "ok" } } },
      "put": {
        "tags": ["Exam"],
        "summary": "更新考试（时间/监考/防作弊/状态）",
        "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Exam" } } } },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/exams/{id}/participants": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Exam"],
        "summary": "导入/新增考生名单",
        "requestBody": { "content": { "application/json": { "schema": { "type": "object", "properties": { "studentIds": { "type": "array", "items": { "type": "integer" } } } } } } },
        "responses": { "200": { "description": "ok" } }
      },
      "get": { "tags": ["Exam"], "summary": "查看考生名单与状态", "responses": { "200": { "description": "ok" } } }
    },
    "/exams/{id}/publish": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": { "tags": ["Exam"], "summary": "发布考试并通知", "responses": { "200": { "description": "ok" } } }
    },
    "/exams/{id}/cancel": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": { "tags": ["Exam"], "summary": "取消考试", "responses": { "200": { "description": "ok" } } }
    },
    "/portal/exams": {
      "get": { "tags": ["Portal"], "summary": "当前用户可参与的考试列表", "responses": { "200": { "description": "ok" } } }
    },
    "/portal/exams/{id}/enter": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": { "tags": ["Portal"], "summary": "进入考试前置检查（身份/设备/时间窗口）", "responses": { "200": { "description": "ok" } } }
    },
    "/portal/exams/{id}/heartbeat": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": { "tags": ["Portal"], "summary": "心跳上报，用于在线/切屏监测", "responses": { "200": { "description": "ok" } } }
    },
    "/portal/exams/{id}/events": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Portal"],
        "summary": "行为/异常事件上报",
        "requestBody": {
          "content": {
            "application/json": { "schema": { "type": "object", "properties": { "eventType": { "type": "string" }, "detail": { "type": "string" }, "occurredAt": { "type": "string", "format": "date-time" } } } }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/portal/exams/{id}/questions": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Portal"], "summary": "获取题目列表（含序号、分值、已答状态）", "responses": { "200": { "description": "ok" } } }
    },
    "/portal/exams/{id}/answers": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Portal"],
        "summary": "保存作答（支持断点续答）",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "type": "object", "required": ["questionId", "studentResponse"], "properties": { "questionId": { "type": "integer" }, "studentResponse": { "type": "string" }, "saveTime": { "type": "string", "format": "date-time" } } }
            }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/portal/exams/{id}/submit": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": { "tags": ["Portal"], "summary": "交卷（可超时自动触发）", "responses": { "200": { "description": "ok" } } }
    },
    "/grading/exams/{id}/auto": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": { "tags": ["Grading"], "summary": "自动评分客观题", "responses": { "200": { "description": "ok" } } }
    },
    "/grading/exams/{id}/answers/ungraded": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Grading"], "summary": "拉取待人工批阅的主观题", "responses": { "200": { "description": "ok" } } }
    },
    "/grading/answers/{answerId}/grade": {
      "parameters": [{ "in": "path", "name": "answerId", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Grading"],
        "summary": "教师批阅主观题",
        "requestBody": {
          "content": { "application/json": { "schema": { "type": "object", "properties": { "score": { "type": "number" }, "comment": { "type": "string" } } } } }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/grading/answers/{answerId}/ai-suggest": {
      "parameters": [{ "in": "path", "name": "answerId", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Grading"], "summary": "AI 返回评分建议", "responses": { "200": { "description": "ok" } } }
    },
    "/scores/exams/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Score"], "summary": "考试成绩列表（含排名、是否最终分）", "responses": { "200": { "description": "ok" } } }
    },
    "/scores/exams/{id}/my": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Score"], "summary": "学生查看自己的成绩与题目得分", "responses": { "200": { "description": "ok" } } }
    },
    "/scores/history": {
      "get": { "tags": ["Score"], "summary": "学生历次考试成绩、排名趋势", "responses": { "200": { "description": "ok" } } }
    },
    "/scores/exams/{id}/wrong-questions": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Score"], "summary": "错题回顾与解析", "responses": { "200": { "description": "ok" } } }
    },
    "/scores/exams/{id}/report": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Score"], "summary": "生成/获取学习报告（弱项分析、建议）", "responses": { "200": { "description": "ok" } } }
    },
    "/dashboard/exams/{id}": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Dashboard"], "summary": "单场考试看板（分数段、热力图）", "responses": { "200": { "description": "ok" } } }
    },
    "/dashboard/classes/{classId}": {
      "parameters": [{ "in": "path", "name": "classId", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Dashboard"], "summary": "班级/课程表现与薄弱点", "responses": { "200": { "description": "ok" } } }
    },
    "/dashboard/exams/{id}/export": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Dashboard"], "summary": "数据下载（CSV/Excel）", "responses": { "200": { "description": "ok" } } }
    },
    "/recommendations/students/{id}/plan": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "post": {
        "tags": ["Recommendation"],
        "summary": "生成个性化学习计划",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "type": "object", "properties": { "goalScore": { "type": "number" }, "weakPoints": { "type": "array", "items": { "type": "string" } } } }
            }
          }
        },
        "responses": { "200": { "description": "ok" } }
      }
    },
    "/recommendations/students/{id}/practice": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Recommendation"], "summary": "获取专项练习题单", "responses": { "200": { "description": "ok" } } }
    },
    "/recommendations/students/{id}/progress": {
      "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
      "get": { "tags": ["Recommendation"], "summary": "跟踪练习效果并更新学习画像", "responses": { "200": { "description": "ok" } } }
    }
  }
}
